#  TopTunes

## 7 Background Sessions

### 07 Challenge Finished
* Implements Background App Refresh

TopTunes uses Feed URLs generated by [iTunes RSS Feed Generator](https://rss.itunes.apple.com/en-us) to display the top 20 songs / hot tracks / new music etc. Background app refresh could be set to run every few hours, to update the top 20.

The top 20 don't change very fast so, for this challenge demo, the background refresh task fetches a different feed type, and sets it to run 30 seconds after the initial task.

>Note: The format of the Feed URLs sometimes changes. If the app cannot get correct JSON data, copy and paste the URL directly from the Feed Generator.

This finished app uses a background session with URLSessionDataDelegate method `urlSession(_:dataTask:didReceive)`. This method, after reloading the table view, creates a new data task, with a different feed URL, set to run 30 seconds from now.

Run the app: it should display Hot Tracks - Country. Wait 30 seconds, and it should display Top Songs. Use the [iTunes RSS Feed Generator](https://rss.itunes.apple.com/en-us) to check.

### Problem
The URLSessionTaskDelegate method `urlSession(_:task:willBeginDelayedRequest:completionHandler:)` doesn't seem to work correctly. If you uncomment the lines that create a new request (Hot Tracks), you'll see that the system calls this method for the __initial__ Hot Tracks - Country data task, although that task does not have an `earliestBeginDate`. I even tried setting this property explicitly to `nil`, and the task's URL still got changed by the delegate method.

Sometimes, the method doesn't get called at all. Switching to a different simulator should fix this.
